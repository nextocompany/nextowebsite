---
phase: 03-quality-ship
plan: 03
type: execute
wave: 2
depends_on:
  - 03-01
  - 03-02
files_modified: []
autonomous: false

requirements:
  - TECH-02
  - TECH-03

must_haves:
  truths:
    - "npm run build succeeds with all changes from plans 01 and 02"
    - "Total page weight under 1MB (excluding fonts)"
    - "Site is live on Cloudflare Pages at nexto.co.th"
  artifacts: []
  key_links: []

user_setup:
  - service: github
    why: "Code hosting for Cloudflare Pages integration"
    env_vars: []
    dashboard_config:
      - task: "Create GitHub repository (can be private)"
        location: "github.com/new or gh repo create"
  - service: cloudflare-pages
    why: "Static site hosting and deployment"
    env_vars: []
    dashboard_config:
      - task: "Create Cloudflare Pages project connected to the GitHub repo"
        location: "Cloudflare Dashboard -> Workers & Pages -> Create application -> Pages -> Connect to Git"
      - task: "Set framework preset to 'Next.js (Static HTML Export)', build command 'npm run build', output directory 'out', env var NODE_VERSION=20"
        location: "Cloudflare Pages project build settings"
      - task: "Add custom domain nexto.co.th"
        location: "Cloudflare Pages project -> Custom domains -> Add"
---

<objective>
Create GitHub repo, push code, set up Cloudflare Pages deploy, and verify the live site.

Purpose: Ship the site live at nexto.co.th. All code changes are done in plans 01 and 02 — this plan handles the build verification, repo creation, and deployment pipeline.
Output: Live site on Cloudflare Pages, GitHub repo with all code pushed.
</objective>

<execution_context>
@/Users/nex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-quality-ship/03-RESEARCH.md
@.planning/phases/03-quality-ship/03-01-SUMMARY.md
@.planning/phases/03-quality-ship/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Final build verification and page weight check</name>
  <files></files>
  <action>
    Run `npm run build` and verify the complete output:

    1. **Build succeeds** — zero errors
    2. **Check build output exists:**
       - `out/index.html` — main page
       - `out/privacy.html` or `out/privacy/index.html` — privacy page
       - `out/sitemap.xml` — sitemap
       - `out/robots.txt` — robots
       - `out/og-placeholder.png` — OG image (copied from public/)
    3. **Verify SEO in index.html:**
       - Title tag: "Nexto — Your operations simplified"
       - Meta description present
       - OG tags (og:title, og:description, og:image)
       - Canonical URL to https://nexto.co.th/
    4. **Page weight check** — Calculate total size of `out/` directory excluding font files (woff2). Must be under 1MB. Run: `find out -type f ! -name '*.woff2' | xargs du -ch | tail -1`
    5. **Verify sitemap.xml** contains both URLs (nexto.co.th and nexto.co.th/privacy)
    6. **Verify robots.txt** contains Allow and sitemap reference

    If any check fails, fix the issue before proceeding. This is the gate before deployment.
  </action>
  <verify>
    All 6 checks above pass. Build output is clean and complete.
  </verify>
  <done>
    Build succeeds. All expected files present in out/. SEO tags correct. Page weight under 1MB. Sitemap and robots.txt valid.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Create GitHub repo and deploy to Cloudflare Pages</name>
  <action>
    Claude will create the GitHub repository using `gh repo create` CLI (if authenticated) and push the code. If `gh` auth fails, this becomes a human action.

    **Step 1 — GitHub repo:**
    Run `gh repo create nextowebsite --private --source=. --remote=origin --push` (or the user's preferred repo name). If gh is not authenticated, provide the manual steps:
    1. Create repo at github.com/new
    2. `git remote add origin git@github.com:USERNAME/nextowebsite.git`
    3. `git push -u origin main`

    **Step 2 — Cloudflare Pages setup (human action):**
    This MUST be done by the user in the Cloudflare Dashboard:
    1. Go to Cloudflare Dashboard -> Workers & Pages -> Create application -> Pages
    2. Connect to Git -> Select the GitHub repo just created
    3. Framework preset: **Next.js (Static HTML Export)**
    4. Build command: `npm run build`
    5. Build output directory: `out`
    6. Environment variables: Add `NODE_VERSION` = `20`
    7. Save and Deploy
    8. After first deploy succeeds: Settings -> Custom domains -> Add `nexto.co.th`
    9. Cloudflare auto-configures DNS since the domain is already on Cloudflare
  </action>
  <how-to-verify>
    After Cloudflare Pages deploys:
    1. Visit https://nexto.co.th — site loads with all sections
    2. Check browser tab shows "Nexto — Your operations simplified"
    3. Visit https://nexto.co.th/privacy — privacy page loads
    4. Visit https://nexto.co.th/sitemap.xml — sitemap loads
    5. Visit https://nexto.co.th/robots.txt — robots.txt loads
    6. Right-click -> View Page Source -> search for "og:" tags
    7. Tab through the page with keyboard — focus rings visible on links and buttons
  </how-to-verify>
  <resume-signal>Type "deployed" when the site is live, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- Build output complete and correct
- GitHub repo created with all code pushed
- Cloudflare Pages project created and deployed
- Site live at nexto.co.th with all quality gates passing
</verification>

<success_criteria>
Site is live on Cloudflare Pages at nexto.co.th. All pages load. SEO metadata correct. Privacy page accessible. Sitemap and robots.txt reachable.
</success_criteria>

<output>
After completion, create `.planning/phases/03-quality-ship/03-03-SUMMARY.md`
</output>
